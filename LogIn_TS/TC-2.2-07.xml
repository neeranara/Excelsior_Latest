<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="1227c8b9-4c23-41db-a54c-04c3d0c1aa76" discardOkResults="true" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="TC-2.2-07" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="1227c8b9-4c23-41db-a54c-04c3d0c1aa76fileName">TC-2.2-07</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="restrequest" name="GET - client_cre" id="6e8b5d2e-1079-4be1-8313-f448cd8095ce"><con:settings/><con:config service="REST Service 1" resourcePath="/connect/token" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GET - client_cre" id="63c49e61-2aee-454a-be4b-c0be665b8ae9" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://excelsiorqa-api.eyekor.com</con:endpoint><con:request/><con:originalUri>https://excelsiorqa-api.eyekor.com/connect/token</con:originalUri><con:assertion type="JsonPath Existence Match" id="a1789372-d8a5-4fe3-a097-addffc8a54bb" name="Check for existence of [access_token]"><con:configuration><path>$['access_token']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="Origin" value="https://excelsiorqa.eyekor.com"/>
  <con:entry key="grant_type" value="client_credentials"/>
  <con:entry key="scope" value="webapi"/>
  <con:entry key="client_secret" value="ExcelsiorWebSecret"/>
  <con:entry key="client_id" value="9E1E36E2-BE2B-4D53-9B18-8078607CABA4"/>
  <con:entry key="Content-Type" value="application/x-www-form-urlencoded"/>
</con:parameters><con:parameterOrder><con:entry>Origin</con:entry><con:entry>Content-Type</con:entry><con:entry>grant_type</con:entry><con:entry>client_id</con:entry><con:entry>client_secret</con:entry><con:entry>scope</con:entry><con:entry>username</con:entry><con:entry>password</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="transfer" name="Token_Transfer" id="fb775408-0638-4f28-ba0d-7c6a4dc9b363"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>access</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>GET - client_cre</con:sourceStep><con:sourcePath>$['access_token']</con:sourcePath><con:targetType>temp_token</con:targetType><con:targetStep>#Project#</con:targetStep><con:targetPath/><con:type>JSONPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="Reset_PW_InvalidAnswer" id="bd61b0d9-c702-494d-be4a-80833a0476db"><con:settings/><con:config service="Excelsior API" resourcePath="/api/v1/Auth/ResetPassword/{username}" methodName="ApiV1AuthResetPasswordByUsernamePost" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Reset_PW_InvalidAnswer" id="6183a50a-7a5c-45f5-aa02-a59cab40a979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://excelsiorqa-api.eyekor.com</con:endpoint><con:request>{
  "Answer": "white",
  "NewPassword": "@eyekor2",
  "PasswordConfirmation": "@eyekor2"
}</con:request><con:originalUri>https://excelsiorqa-api.eyekor.com/api/v1/Auth/ResetPassword/admin</con:originalUri><con:assertion type="JsonPath Match" id="0be9615e-a8a1-4196-9361-7ae6bbaca6f5" name="Match content of [isSuccess]"><con:configuration><path>$['isSuccess']</path><content>false</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f1effe8a-ed56-4721-b2f1-a3428c03c36a" name="Match content of [exception]"><con:configuration><path>$['exception']</path><content>Invalid answer</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="Authorization" value="${#Project#token_type}${#Project#temp_token}"/>
  <con:entry key="username" value="admin"/>
</con:parameters><con:parameterOrder><con:entry>username</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="Reset_PW_ValidAnswer" id="8a604863-9084-4818-b0a0-a009b82a49f5"><con:settings/><con:config service="Excelsior API" resourcePath="/api/v1/Auth/ResetPassword/{username}" methodName="ApiV1AuthResetPasswordByUsernamePost" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Reset_PW_ValidAnswer" id="6183a50a-7a5c-45f5-aa02-a59cab40a979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://excelsiorqa-api.eyekor.com</con:endpoint><con:request>{
  "Answer": "black",
  "NewPassword": "@eyekor2",
  "PasswordConfirmation": "@eyekor2"
}</con:request><con:originalUri>https://excelsiorqa-api.eyekor.com/api/v1/Auth/ResetPassword/admin</con:originalUri><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="Authorization" value="${#Project#token_type}${#Project#temp_token}"/>
  <con:entry key="username" value="admin"/>
</con:parameters><con:parameterOrder><con:entry>username</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="goto" name="Reset_Condition" id="e4535f83-e118-4278-8c86-f4707ee9e059"><con:settings/><con:config xsi:type="con:GotoStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:condition><con:name>SamePassword</con:name><con:type>XPATH</con:type><con:expression>declare namespace ns1='https://excelsiorqa-api.eyekor.com/api/v1/Auth/ResetPassword/admin';
matches(//ns1:Response[1]/ns1:exception[1]/text(), 'Please use a different password')</con:expression><con:targetStep>Reset_Again</con:targetStep></con:condition><con:condition><con:name>DiffPassword</con:name><con:type>XPATH</con:type><con:expression>declare namespace ns1='https://excelsiorqa-api.eyekor.com/api/v1/Auth/ResetPassword/admin';
matches(//ns1:Response[1]/ns1:isSuccess[1]/text(), 'true')</con:expression><con:targetStep>Script_LoginWithValidPW</con:targetStep></con:condition></con:config></con:testStep><con:testStep type="restrequest" name="Reset_Again" id="f2b197da-981c-4854-88d5-5286d685cdfd"><con:settings/><con:config service="Excelsior API" resourcePath="/api/v1/Auth/ResetPassword/{username}" methodName="ApiV1AuthResetPasswordByUsernamePost" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Reset_Again" id="6183a50a-7a5c-45f5-aa02-a59cab40a979" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://excelsiorqa-api.eyekor.com</con:endpoint><con:request>{
  "Answer": "black",
  "NewPassword": "@eyekor1",
  "PasswordConfirmation": "@eyekor1"
}</con:request><con:originalUri>https://excelsiorqa-api.eyekor.com/api/v1/Auth/ResetPassword/admin</con:originalUri><con:assertion type="JsonPath Match" id="03f1adc4-b9ab-462e-88eb-61dbb5989deb" name="Match content of [isSuccess]"><con:configuration><path>$['isSuccess']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="Authorization" value="${#Project#token_type}${#Project#temp_token}"/>
  <con:entry key="username" value="admin"/>
</con:parameters><con:parameterOrder><con:entry>username</con:entry><con:entry>Authorization</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="Script_LoginWithValidPW" id="3537fc39-8da3-4f9b-9e99-8808e3dc3d8d"><con:settings/><con:config><script>for( r in testRunner.results )
log.info "TestStep [" + r.testStep.name + "] finished with status " + r.status

def myList = []
for( r in testRunner.results )
{
		myList.add(r.testStep.name)
		
}
if(myList.contains("Reset_Again"))
{
	testRunner.testCase.setPropertyValue("LoginPW", "@eyekor1")
    log.info("@eyekor1 is the new login password")
}
else
{
	testRunner.testCase.setPropertyValue("LoginPW", "@eyekor2")
	log.info("@eyekor2 is the new login password")
}

</script></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" id="93c222e5-ada9-4bc3-a7ec-305ce66004a6"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>PleaseGod</con:name><con:sourceType>LoginPW</con:sourceType><con:sourceStep>#TestCase#</con:sourceStep><con:sourcePath/><con:targetType>password</con:targetType><con:targetStep>LogIn_CheckPWReset</con:targetStep><con:targetPath/><con:type>XPATH</con:type><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="restrequest" name="LogIn_CheckPWReset" id="94714e94-ed9c-4cf0-81b6-60e2110327d8"><con:settings/><con:config service="REST Service 1" resourcePath="/connect/token" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="LogIn_CheckPWReset" id="63c49e61-2aee-454a-be4b-c0be665b8ae9" mediaType="application/x-www-form-urlencoded" postQueryString="true"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://excelsiorqa-api.eyekor.com</con:endpoint><con:request/><con:originalUri>https://excelsiorqa-api.eyekor.com/connect/token</con:originalUri><con:assertion type="JsonPath Existence Match" id="35a03ac8-d07e-4c84-bf14-4839e437b18f" name="Check for existence of [access_token]"><con:configuration><path>$['access_token']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="Origin" value="https://excelsiorqa.eyekor.com"/>
  <con:entry key="password" value="@eyekor2"/>
  <con:entry key="grant_type" value="password"/>
  <con:entry key="scope" value="webapi offline_access"/>
  <con:entry key="client_secret" value="ExcelsiorWebSecret"/>
  <con:entry key="client_id" value="9E1E36E2-BE2B-4D53-9B18-8078607CABA4"/>
  <con:entry key="Content-Type" value="application/x-www-form-urlencoded"/>
  <con:entry key="username" value="${#Project#username}"/>
</con:parameters><con:parameterOrder><con:entry>Origin</con:entry><con:entry>Content-Type</con:entry><con:entry>grant_type</con:entry><con:entry>client_id</con:entry><con:entry>client_secret</con:entry><con:entry>scope</con:entry><con:entry>username</con:entry><con:entry>password</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>LoginPW</con:name><con:value>@eyekor2</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>fb775408-0638-4f28-ba0d-7c6a4dc9b363</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3537fc39-8da3-4f9b-9e99-8808e3dc3d8d</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>93c222e5-ada9-4bc3-a7ec-305ce66004a6</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase>